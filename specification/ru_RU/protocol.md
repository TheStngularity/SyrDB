# Спецификация `SyrDB Protocol` 0.1
## `1.` Примечания
### `1.1.` Типы данных
Все типы данного протокола взяты из `BDSF`[^1] формата хранения данных.

## `2.` Запрос и Ответ
### `2.1.` Запрос
Запрос к данной СУБД[^2] состоит из нескольких блоков. Первый блок это код операции. Его тип это `Byte`, а длина - **1 байт**. Все его возможные значения вы можете посмотреть в пункте `3.1.`

&nbsp;&nbsp;&nbsp;&nbsp;Следующий блок - это заголовки запроса *(см. пункт `3.3.` этой спецификации)*. Его длина может быть любой.

&nbsp;&nbsp;&nbsp;&nbsp;Ну и последний блок. Он представляет из себя содержимое запроса *(см. пункт `3.4.` этой спецификации)*.

Данные блоки можно представить в виде такой схемы:
```py
Request {
    Byte     op      (1);
    Header[] headers (N);
    Content  content (N);
}
```

### `2.2.` Ответ
Теперь перейдём к ответу от сервера. он состоит тоже из трёх блоков. Первый блок - это код статуса. Его тип это опять же `Byte`. Все его возможные значения вы можете посмотреть в пункте `3.2.`

&nbsp;&nbsp;&nbsp;&nbsp;Следующий блок - это заголовки ответа *(см. пункт `3.3.` этой спецификации)*. Его длина может быть любой.

&nbsp;&nbsp;&nbsp;&nbsp;Ну и последний блок. Он представляет из себя содержимое ответа *(см. пункт `3.4.` этой спецификации)*.

## `3.` Типы данных
### `3.1.` Коды операции
Все операции с SyrDB имеют свой код. Давайте разберём их по очереди. Ответ - это содержимое блока с названием "содержимое" в объекте ответа от сервера. Тем временем аргументы - это `BDSF`[^1] словарь в поле содержимого всё такого же блока, но уже в запросе.

#### `00`: Авторизация (![server](https://img.shields.io/badge/-%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80-lightgrey))
**Аргументы:**
- `auth_token` (`String`) - токен авторизации
- `username` (`String`) - имя пользователя
- `password` (`String`) - пароль пользователя
- `database` (`String`) - название базы данных, с которой можно работать этому пользователю. `*` - для указания всех.
- `provider` (`ConnectionProvider`, *пункт 3.6.*) - провайдер подключения *(библиотека)*

#### `01`: Получение информации о сервере (![server](https://img.shields.io/badge/-%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80-lightgrey))
**Ответ:** Ответ данной операции представляет из себя `BDSF`[^1] словарь. Его содержимое я поясню с помощью таблицы.
Ключ                | Тип          | Описание
------------------- | ------------ | --------------------------
`version`           | `String`     | Версия сервера
`clients`           | `UInt`[^3]   | Кол-во клиентов
`process`           | `Dictionary` | Информация о процессе
`process.pid`       | `UInt`[^3]   | PID процесса сервера
`process.ram`       | `Dictionary` | ОЗУ процесса
`process.ram.used`  | `UInt`[^3]   | Используемое процессом ОЗУ
`process.ram.total` | `UInt`[^3]   | Всё ОЗУ в системе

#### `02`: Обновить сервер (если есть обновления) (![server](https://img.shields.io/badge/-Сервер-lightgrey))
**Аргументы:**
- `channel` (`UInt8`) - канал обновлений. 
   - `00` - канал релизов.
   - `01` - канал кандидатов на релиз.
   - `02` - канал бета версий.
   - `03` - канал альфа версий.
   - `04` - канал разрабатываемых версий. **НЕ рекомендуется!**

**Ответ:** `Byte`. `00` - обновлений нет. `01` - сервер обновляется.

#### `03`: Получения списка всех баз данных (![db](https://img.shields.io/badge/-Базы%20данных-orange))
**Ответ:** Список `BDSF`[^1] словарей. Держите таблицу ключей в этом словаре.
Ключ               | Тип                   | Описание
------------------ | --------------------- | --------------------
`name`             | `String`              | Название базы данных
`collections`      | `UInt`                | Кол-во коллекций
`type`             | `Byte` (*пункт 3.5.*) | Тип базы данных

#### `04`: Создать базу данных (![db](https://img.shields.io/badge/-Базы%20данных-orange))
**Аргументы:**
- `name` (`String`) - название базы данных.
- `type` (`Byte`, *пункт 3.5.*) - тип базы данных, опционально. По умолчанию: `02`.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло создание базы данных.

#### `05`: Удалить базу данных (![db](https://img.shields.io/badge/-Базы%20данных-orange))
**Аргументы:**
- `name` (`String`) - название базы данных.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло удаление базы данных.

#### `06`: Изменить базу данных (![db](https://img.shields.io/badge/-Базы%20данных-orange))
**Аргументы:**
- `name` (`String`) - название базы данных.
- `new_name` (`String`) - новое название базы данных, опционально.
- `type` (`Byte`, *пункт 3.5.*) - новый тип базы данных, опционально.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло изменение базы данных.

#### `07`: Список коллекций (![coll](https://img.shields.io/badge/-Коллекции-yellow))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.

**Ответ:** Список `BDSF`[^1] словарей. Вот таблица.
Ключ               | Тип                   | Описание
------------------ | --------------------- | ---------------------------
`name`             | `String`              | Название коллекции
`objects`          | `UInt`                | Кол-во объектов в коллекции
`type`             | `Byte` (*пункт 3.5.*) | Тип коллекции

#### `08`: Создать коллекцию (![coll](https://img.shields.io/badge/-Коллекции-yellow))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название коллекции.
- `type` (`Byte`, *пункт 3.5.*) - тип коллекции.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло создание коллекции.

#### `09`: Удалить коллекцию (![coll](https://img.shields.io/badge/-Коллекции-yellow))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название коллекции.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло удаление коллекции.

#### `0A`: Изменить коллекцию (![coll](https://img.shields.io/badge/-Коллекции-yellow))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название коллекции.
- `new_database` (`String`) - название новой родительской базы данных, опционально.
- `new_name` (`String`) - новое название коллекции, опционально.
- `new_type` (`Byte`, *пункт 3.5.*) - новый тип коллекции, опционально.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло изменение коллекции.

#### `0B`: Внести объект в коллекцию (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `data` (`Dictionary`) - данные объекта.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло внесение объекта в коллекцию.

#### `0C`: Обновить объект в коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объекта.
- `data` (`Dictionary`) - новые данные объекта.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло изменение объекта.

#### `0D`: Обновить множество объектов в коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объектов.
- `data` (`Dictionary`) - новые данные объектов.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло изменение объектов.

#### `0E`: Удалить объект из коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объекта.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло удаления объекта.

#### `0F`: Удалить множество объектов из коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объектов.

**Ответ:** `UInt`[^3]. Количество миллисекунд, которое заняло удаления объектов.

#### `10`: Найти объект в коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объекта.

**Ответ:** `Dictionary`. Данные объекта.

#### `11`: Найти множество объектов в коллекции (![object](https://img.shields.io/badge/-Объекты-brightgreen))
**Аргументы:**
- `database` (`String`) - название родительской базы данных.
- `name` (`String`) - название родительской коллекции.
- `filter` (`Dictionary`) - фильтр для поиска объектов.

**Ответ:** `List[Dictionary]`. Данные объектов.

### `3.2.` Код статуса
А вот уже код статуса можно описать таблицей.

Байт-код | Категория                                                       | Описание
-------- | --------------------------------------------------------------- | ------------------------------------
`00`     | ![success](https://img.shields.io/badge/-Успех-green)           | Операция выполнена успешно
`01`     | ![err](https://img.shields.io/badge/-Ошибка%20(Сервер)-red)     | Неизвестная ошибка
`02`     | ![err](https://img.shields.io/badge/-Ошибка%20(Сервер)-red)     | Файл базы данных недоступен
`03`     | ![cerr](https://img.shields.io/badge/-Ошибка%20(Клиент)-orange) | Авторизация не пройдена
`04`     | ![cerr](https://img.shields.io/badge/-Ошибка%20(Клиент)-orange) | Недостаточно прав
`05`     | ![cerr](https://img.shields.io/badge/-Ошибка%20(Клиент)-orange) | У вас нет доступа к этой базе данных
`06`     | ![cerr](https://img.shields.io/badge/-Ошибка%20(Клиент)-orange) | Недостаточно аргументов
`07`     | ![cerr](https://img.shields.io/badge/-Ошибка%20(Клиент)-orange) | Неверный тип аргумента

### `3.3.` Заголовки запроса и ответа
#### `3.3.1.` Формат
Каждый заголовок состоит из 3 блоков. Первый блок - это его байт-код *(см. пункт 3.3.2. этой спецификации)*. Далее идёт блок длины. Это число формата `UInt16`. Он представляет из себя длину содержимого заголовка. Ну и последний блок - это само содержимое заголовка. Оно может быть любого типа. Тип закрепляется за предопределёнными заголовками из пункта 3.3.2.

### `3.3.2.` Список заголовков
Их лучше показать в виде таблицы. `З` обозначает "Запрос". `О` обозначает "Ответ"
Байт-код | Название        | Тип                       | З/О  | Описание
-------- | --------------- | ------------------------- | ---- | ----------------
`00`     | **Version**     | `UInt` *(см. `3.3.3.`)*   | З, О | Версия протокола
`01`     | **Description** | `String`                  | О    | Описание ответа

### `3.3.3.` Версии протокола
Байт | Версия         | Описание
---- | -------------- | -----------------------------
`01` | `0.0.1a1.dev1` | Первая версия это базы данных

### `3.4.` Содержимое запроса и ответа
Содержимое запроса и ответа состоит из двух блоков. Первый блок - байт типа. Если содержимого нет, то `00`. Следующий блок - это данные, прописанные по спецификации типа, указанного в первом блоке.

### `3.5.` Тип баз данных и коллекций
Байт-код | Описание
-------- | -------------------------------------
`00`     | `NoSQL` база данных или коллекция
`01`     | `SQL` база данных или коллекция
`02`     | `Cмешанная` база данных или коллекция

### `3.6.` Объект провайдера подключения
Объект провайдера это единственный тип с 4 блоками. Первый блок - это язык программирования, на котором **ИЛИ** для которого написана библиотека. Представляет из себя объекта типа `String`.

&nbsp;&nbsp;&nbsp;&nbsp;Второй блок - это название библиотеки. Опять же `String`. Третий блок - это версия библиотеки. И снова `String`.

&nbsp;&nbsp;&nbsp;&nbsp;Ну и последний блок - это ID провайдера. Представляет из себя объект типа `Byte[16]`. Если такого нет, то `00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00`

[^1]: BDSF *(**англ.** Binary Data Storage Format)* - Двоичный формат хранения данных.
[^2]: СУБД - **С**истема **У**правления **Б**азами **Д**анных.
[^3]: `UInt` - это число от `UInt8` до `UInt128` с указанием байтом типа.